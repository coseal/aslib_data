# Author: Haniye Kashgarani
# Affiliation: University of Wyoming
# Date: 2023-08-17T15:39:37+00:00
# Github: haniyeka

name: aslib_data_check

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
  workflow_dispatch:

jobs:
  Build_Makefile:
    runs-on: ubuntu-latest
    container:
      # Docker image that includes python2.7, and libraries like liac-arff, pyyaml, and typing
      # This docker also includes files from https://github.com/coseal/aslib-spec/tree/master/data_check_tool_python in /usr/src/app/data_check_tool_python
      image: haniyeka/aslib_data_check:latest
    steps:
    - uses: actions/checkout@v3

    - name: Find changed directories
      run: echo "DIRS=$(git diff --name-only ${{ github.event.before }} ${{ github.sha }} | grep '/.*$' | sed -E 's@(.*)/@\1@' | sort -u)" >> $GITHUB_ENV

    - name: Run script on changed directories
      run: |
        echo "Current directory:"
        echo $(pwd)
        ls
        echo $DIRS

        for dir in $DIRS; do
          if [ -d "$dir" ]; then
            /usr/src/app/data_check_tool_python/src/main.py --dir "$dir"
          fi
        done
